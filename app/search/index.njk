{% extends "common/templates/layout.njk" %}

{% block page_title %}
   __('Search results')
{% endblock %}

{% block content %}
  <main id="content" role="main">
    <form action="/search" method="GET">
      <div class="dgu-split-background__top">
        <div class="dgu-split-background__top-inner">
          {# include "feedback_survey_banner.njk" #}
          <h1 class="heading-large">{{ __('Search results') }}</h1>
          <div class="grid-row">
            <div class="column-two-thirds dgu-search-box">
              <label for="q" class="visuallyhidden">{{ __('Search') }} %></label>
              <input id="q"
                name="q"
                type="text"
                class="form-control dgu-search-box__input"
                value="{{ query }}"/><button type="submit" class="dgu-search-box__button">{{ __('Search') }}</buton>
          </div>
        </div>
      </div>
    </div>

  <div class="dgu-split-background__bottom">
    <div class="grid-row dgu-filters">
      <div class="column-one-third">
        {# include 'filters' #}
      </div>

      <div class="column-two-thirds dgu-results">
        {# include 'sort' #}

        {% if query %}
          <span class="dgu-results__summary">
            <span class="bold-small">{{ results.length }}</span>
            {{ __('results found for') }} <span class="bold-small">‘{{ query }}’</span>
          </span>
        {% endif %}

        {% if not query and selected_filters %}
          {{ __('datasets') }}
        {% endif %}

        {% if @organisation.present? %}
          {{ __('Published by') }} <span class="bold-small">‘{{ organisation }}’</span>
        {% endif %}

        {% if selected_filters.any? %}
          {{ __('Filtered by') }} {# selected_filters.to_sentence #}
        {% endif %}

        <div>
          {% if results.length == 0 %}
            <h2 class="heading-medium"> {{ __('.zero_result_tips.try') }}:</h2>
            <ul class="list list-bullet">
              <li>{{ __('.zero_result_tips.different_words') }}</li>
              <li>{{ __('.zero_result_tips.clear_filters') }}</li>
            </ul>
          {% else %}
            {% for d in results %}
              <div class="dgu-results__result">
                <h2 class="heading-medium">
                  {%= link_to d.title, dataset_path(d.uuid, d.name) %}
                </h2>
                <dl class="dgu-metadata__box">
                  {% if d.datafiles.none? %}
                    <dt>{{ __('.meta_data_box.availability') }}:</dt>
                    <dd>
                      <span class="dgu-highlight">Not released</span>
                    </dd>
                  {% endif %}
                  <dt>{{ __('.meta_data_box.published_by') }}:</dt>
                  <dd>{%= link_to d.organisation['title'], search_path(publisher: d.organisation['title']) %}</dd>
                  <dt>{{ __('.meta_data_box.last_updated') }}:</dt>
                  {% if d.last_updated_at.present? %}
                    <dd>{%= format(d.last_updated_at) %}</dd>
                  {% else %}
                    <dd class="dgu-secondary-text"> {{ __('.meta_data_box.not_applicable') }}</dd>
                  {% endif %}
                  <dt>{{ __('.meta_data_box.geo_area') }}:</dt>
                  {% if d.location1.present? %}
                    <dd>{%= d.location1 %}</dd>
                  {% else %}
                    <dd class="dgu-secondary-text"> {{ __('.meta_data_box.not_applicable') }}</dd>
                  {% endif %}
                </dl>
                <p>{%= truncate(strip_tags(d.summary), length: 200, separator: ' ') %}</p>
              </div>
            {% endfor %}
            <div class="dgu-pagination">
              <nav>
                {# page_entries_info @datasets, entry_name: 'dataset' #}
                <span class="dgu-pagination__numbers">{%= paginate @datasets, window: 2 %}</span>
              </nav>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</form>
  </main>
{% endblock %}
